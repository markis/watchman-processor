#!/usr/bin/env node

process.title = 'watchman-processor';

var index = require('../index');
var watchman = index.processor;
var terminal = index.terminal;
var WatchmanProcessorEvent = index.WatchmanProcessorEvent;

if (watchman && typeof watchman.start === 'function') {
  watchman.emitter.on(WatchmanProcessorEvent.Error, function (params) {
   terminal.error(params.err);
  });
  watchman.emitter.on(WatchmanProcessorEvent.Debug, function (params) {
   terminal.debug(params.msg);
  });
  watchman.emitter.on(WatchmanProcessorEvent.SetState, function (params) {
   terminal.setState(params.configEntry, params.state, params.statusMessage);
  });
  watchman.emitter.on(WatchmanProcessorEvent.Render, terminal.render.bind(terminal));
  watchman.start()
}
process.on('SIGINT', function() {
  watchman.end().then(function() {
    process.exit();
  });
});
